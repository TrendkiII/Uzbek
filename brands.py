# ==================== БРЕНДЫ И ВАРИАЦИИ ====================

BRAND_GROUPS = [
    {
        "main": "L.G.B.",
        "variations": {
            "latin": ["L.G.B.", "LGB", "Le grand bleu", "Le grande bleu", "Le Grand Bleu",
                      "Legrandbleu", "Le grande blue", "L G B", "L G.B.", "L.G B"],
            "jp": ["ルグランブルー", "ル・グラン・ブルー", "エルジービー"],
            "cn": ["大蓝", "勒格朗蓝", "勒格朗布尔"],
            "universal": ["LGB vintage", "Le grand bleu vintage"]
        }
    },
    {
        "main": "if six was nine",
        "variations": {
            "latin": ["if six was nine", "ifsixwasnine", "if 6 was 9", "if6was9",
                      "Maniac corp", "bedrock", "Maniac Corporation", "Maniac", "Bed Rock"],
            "jp": ["イフシックスワズナイン", "イフ・シックス・ワズ・ナイン"],
            "cn": ["如果六是九", "伊夫西克斯瓦兹奈因"],
            "universal": ["if six was nine vintage", "ifsixwasnine archive"]
        }
    },
    {
        "main": "kmrii",
        "variations": {
            "latin": ["kmrii", "kemuri", "km rii", "km*rii", "km-rii", "km_rii", "KMRII"],
            "jp": ["ケムリ"],
            "cn": ["烟", "凯穆里"],
            "universal": ["kemuri vintage", "kmrii vintage"]
        }
    },
    {
        "main": "14th addiction",
        "variations": {
            "latin": ["14th addiction", "14thaddiction", "14th addition", "14th addict",
                      "14th adiction", "14th addictions", "14th-addiction", "14th_addiction",
                      "Fourteenth addiction"],
            "jp": ["14番目の中毒", "フォーティーンスアディクション"],
            "cn": ["第14瘾", "第十四瘾", "14号瘾", "十四号瘾", "福提恩阿迪克申"],
            "universal": ["14th addiction vintage", "14th archive"]
        }
    },
    {
        "main": "share spirit",
        "variations": {
            "latin": ["share spirit", "sharespirit", "share-spirit", "share_spirit",
                      "share sprit", "share sperit"],
            "jp": ["シェアスピリット", "シェアースピリット"],
            "cn": ["分享精神", "共享精神", "谢尔斯皮里特"],
            "universal": ["share spirit vintage"]
        }
    },
    {
        "main": "gunda",
        "variations": {
            "latin": ["gunda", "ganda"],
            "jp": ["グンダ"],
            "cn": ["贡达", "古恩达"],
            "universal": ["gunda vintage"]
        }
    },
    {
        "main": "yasuyuki ishii",
        "variations": {
            "latin": ["yasuyuki ishii", "yasuyuki-ishii", "yasuyuki_ishii", "yasuyuki ishi"],
            "jp": ["石井康之", "イシイヤスユキ"],
            "cn": ["雅之石井"],
            "universal": ["yasuyuki ishii vintage"]
        }
    },
    {
        "main": "gongen",
        "variations": {
            "latin": ["gongen"],
            "jp": ["権現"],
            "cn": ["权现"],
            "universal": ["gongen vintage"]
        }
    },
    {
        "main": "blaze",
        "variations": {
            "latin": ["blaze", "blaz", "blase"],
            "jp": ["ブレイズ"],
            "cn": ["火焰", "布雷兹"],
            "universal": ["blaze vintage"]
        }
    },
    {
        "main": "shohei takamiya",
        "variations": {
            "latin": ["shohei takamiya", "shoheitakamiya", "shohei_takamiya", "takamiya"],
            "jp": ["高宮翔平", "タカミヤショウヘイ"],
            "cn": ["高宫翔平", "塔卡米亚翔平"],
            "universal": ["shohei takamiya vintage"]
        }
    },
    {
        "main": "wild heart",
        "variations": {
            "latin": ["wild heart", "wildheart", "wild-heart", "wild_heart", "wild hart"],
            "jp": ["ワイルドハート"],
            "cn": ["野性之心", "狂野之心", "怀尔德哈特"],
            "universal": ["wild heart vintage"]
        }
    },
    {
        "main": "john moore",
        "variations": {
            "latin": ["john moore", "johnmoore", "john-moore", "john_moore", "john moor"],
            "jp": ["ジョンムーア"],
            "cn": ["约翰摩尔"],
            "universal": ["john moore vintage"]
        }
    },
    {
        "main": "ian reid",
        "variations": {
            "latin": ["ian reid", "ian reed", "ian-reid", "ian_reed", "ianreed"],
            "jp": ["イアンリード"],
            "cn": ["伊恩里德", "伊恩瑞德"],
            "universal": ["ian reid vintage"]
        }
    },
    {
        "main": "House of Beauty and Culture",
        "variations": {
            "latin": ["House of Beauty and Culture", "HBC", "Hobac", "House of Beauty & Culture",
                     "The House of Beauty and Culture", "HOBAC"],
            "jp": ["ハウスオブビューティアンドカルチャー"],
            "cn": ["美丽文化之家", "霍巴克"],
            "universal": ["HBC vintage"]
        }
    },
    {
        "main": "Koji Kuga",
        "variations": {
            "latin": ["Koji Kuga", "kouji kuga", "koji kuga", "koga koji"],
            "jp": ["久賀浩司", "クガコウジ", "久我浩二", "コージクガ"],
            "cn": ["久贺浩司", "库加科吉"],
            "universal": ["koji kuga vintage"]
        }
    },
    {
        "main": "beauty:beast",
        "variations": {
            "latin": ["beauty:beast", "beauty beast", "beauty-beast", "beauty_beast",
                     "beauty & beast", "beauty and beast", "beautybeast"],
            "jp": ["ビューティービースト"],
            "cn": ["美女与野兽", "比蒂比斯特"],
            "universal": ["beauty beast vintage"]
        }
    },
    {
        "main": "The old curiosity shop",
        "variations": {
            "latin": ["The old curiosity shop", "Old Curiosity Shop", "The Old Curiosity Shop",
                     "Old Curiosity", "Curiosity Shop", "Daita Kimura"],
            "jp": ["オールドキュリオシティーショップ", "木村大汰"],
            "cn": ["古老奇趣店", "代田木村"],
            "universal": ["old curiosity shop vintage"]
        }
    },
    {
        "main": "Swear",
        "variations": {
            "latin": ["Swear", "Swear London", "Swear Alternative", "Swear-Alternative",
                     "swear london", "swear alternative"],
            "jp": ["スウェア", "スウェアロンドン"],
            "cn": ["宣誓", "斯维尔"],
            "universal": ["swear vintage"]
        }
    },
    {
        "main": "fotus",
        "variations": {
            "latin": ["fotus", "FÖTUS", "Fötus", "Foetus", "Spuren", "spüren"],
            "jp": ["フォタス", "フェトウス"],
            "cn": ["福图斯", "斯普伦"],
            "universal": ["fotus vintage"]
        }
    },
    {
        "main": "Saint Tropez",
        "variations": {
            "latin": ["Saint Tropez", "SaintTropez", "Saint-Tropez", "Saint_Tropez",
                     "St Tropez", "Saint Tropaz"],
            "jp": ["サン・トロペ"],
            "cn": ["圣特罗佩"],
            "universal": ["saint tropez vintage"]
        }
    },
    {
        "main": "Barcord",
        "variations": {
            "latin": ["Barcord", "Barcode", "Bar code", "Bar-code", "Barcorde"],
            "jp": ["バーコード"],
            "cn": ["条形码", "巴科德"],
            "universal": ["barcord vintage"]
        }
    },
    {
        "main": "paison&drug",
        "variations": {
            "latin": ["paison&drug", "python&drug", "paison and drug", "python and drug",
                     "paison & drug", "python & drug", "poison&drug"],
            "jp": ["パイソン&ドラッグ"],
            "cn": ["派森与毒", "派森和药"],
            "universal": ["paison drug vintage"]
        }
    },
    {
        "main": "Prego",
        "variations": {
            "latin": ["Prego", "Prego Uomo", "Prego-Uomo", "Prego_Uomo", "Prigo"],
            "jp": ["プレゴ"],
            "cn": ["普雷戈", "普雷戈乌莫"],
            "universal": ["prego vintage"]
        }
    }
]

BRAND_MAIN_NAMES = [group["main"] for group in BRAND_GROUPS]
POPULAR_BRANDS = BRAND_MAIN_NAMES[:10]

ALL_PLATFORMS = [
    'Mercari JP',
    'Rakuten Rakuma',
    'Yahoo Flea',
    'Yahoo Auction',
    'Yahoo Shopping',
    'Rakuten Mall',
    'eBay',
    '2nd Street JP'
]

PLATFORM_LANGUAGES = {
    'Mercari JP': ['jp', 'latin', 'universal'],
    'Rakuten Rakuma': ['jp', 'latin', 'universal'],
    'Yahoo Flea': ['jp', 'latin', 'universal'],
    'Yahoo Auction': ['jp', 'latin', 'universal'],
    'Yahoo Shopping': ['jp', 'latin', 'universal'],
    'Rakuten Mall': ['jp', 'latin', 'universal'],
    'eBay': ['latin', 'universal'],
    '2nd Street JP': ['jp', 'latin', 'universal'],
}

def get_variations_for_platform(brand_main, platform):
    """
    Возвращает список всех вариаций бренда для конкретной платформы
    """
    for group in BRAND_GROUPS:
        if group["main"] == brand_main:
            vars_list = []
            needed = PLATFORM_LANGUAGES.get(platform, ['latin', 'universal'])
            for typ in needed:
                if typ in group["variations"]:
                    vars_list.extend(group["variations"][typ])
            return list(dict.fromkeys(vars_list))
    return [brand_main]

def expand_selected_brands_for_platforms(selected_brands, platforms):
    """
    Возвращает словарь: {platform: [вариации выбранных брендов]}
    """
    result = {}
    for p in platforms:
        vars_list = []
        for brand in selected_brands:
            vars_list.extend(get_variations_for_platform(brand, p))
        result[p] = list(dict.fromkeys(vars_list))
    return result

# ==================== НОВАЯ ФУНКЦИЯ ДЛЯ ОПРЕДЕЛЕНИЯ БРЕНДА ИЗ НАЗВАНИЯ ТОВАРА ====================
def detect_brand_from_title(title):
    """
    Определяет бренд по названию товара.
    Ищет вхождения всех вариаций (на разных языках) в заголовок.
    Возвращает основное имя бренда или None, если ничего не найдено.
    """
    if not title:
        return None
    
    title_lower = title.lower()
    
    for group in BRAND_GROUPS:
        # Проверяем все вариации бренда
        for typ in ['latin', 'jp', 'cn', 'universal']:
            if typ in group['variations']:
                for var in group['variations'][typ]:
                    if var.lower() in title_lower:
                        return group["main"]
        
        # Запасной вариант – проверяем основное имя
        if group["main"].lower() in title_lower:
            return group["main"]
    
    return None

# Старую функцию оставляем для обратной совместимости (если где-то используется)
def get_main_brand_by_variation(variation):
    """
    Устаревшая функция. Используйте detect_brand_from_title для названий товаров.
    """
    if not variation:
        return None
    variation_lower = variation.lower().strip()
    for group in BRAND_GROUPS:
        for typ in ['latin', 'jp', 'cn', 'universal']:
            if typ in group['variations']:
                for var in group['variations'][typ]:
                    if var.lower().strip() == variation_lower:
                        return group["main"]
    return None